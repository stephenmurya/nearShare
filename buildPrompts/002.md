# Build Step 002: Core Authentication (Google & Email)

## Task Description
Implement the authentication flow, prioritizing Google Sign-In with Email/Password as a fallback.

## Discovery
- [schemas/users.md](file:///c:/Users/USER/Documents/dev/nearShare/buildPrompts/schemas/users.md)
- [endpoints/auth_endpoint_google.md](file:///c:/Users/USER/Documents/dev/nearShare/buildPrompts/endpoints/auth_endpoint_google.md)

## PROMPT
Implement the authentication feature in Flutter:
1. Create an `AuthService` that handles:
   - `signInWithGoogle()`: Primary login method.
   - `signInWithEmail()` and `signUpWithEmail()`.
   - `signInAnonymously()`: For Guest Mode.
   - `signOut()`.
2. Implement the following screens:
   - `LandingPage`: The entrance with Google, Email, and Guest options.
   - `LoginPage`: Email/Password login.
   - `SignUpPage`: Email registration flow.
   - `PhoneInputPage`: Secondary step for new Google users.
   - `OTPVerifyPage`: 4-digit verification for WhatsApp OTP (Mocked for now).
3. On successful Google login, check for `isNewUser` and redirect to `PhoneInputPage` if necessary.
4. Implement an `AuthWrapper` and `AuthProvider` to manage auth status and redirect users accordingly.

## SUCCESS CRITERIA
- User can sign in via Google, Email, or as a Guest.
- New Google users are prompted for a phone number.
- All registration paths (Google/Email) lead to the 4-digit OTP verification.
- Guest users can browse but are restricted from "List" or "Rent" actions (State-based).
- Firestore `users` contains records for authenticated users.

## VERIFICATION PROMPT
"Verify the AuthRepository logic. Ensure Google Sign-In correctly triggers the Firestore document creation. Mock a successful login and verify the redirection."

---
Generated by VisualPRD
